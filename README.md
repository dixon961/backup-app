# Automated Docker Backup Service

–ü—Ä–æ—Å—Ç–æ–π, –Ω–æ –º–æ—â–Ω—ã–π —Å–µ—Ä–≤–∏—Å –¥–ª—è —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π —Å Linux-—Å–µ—Ä–≤–µ—Ä–∞ –≤ –æ–±–ª–∞—á–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ. –°–µ—Ä–≤–∏—Å —É–ø–∞–∫–æ–≤–∞–Ω –≤ Docker, —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ –µ–¥–∏–Ω—ã–π `config.yml` –∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω —Å Telegram –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∏ **–∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è**.

## ‚ú® –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

-   **–ì–∏–±–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞:** –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—Å–µ–º–∏ –∑–∞–¥–∞—á–∞–º–∏ —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è —á–µ—Ä–µ–∑ –æ–¥–∏–Ω `config.yml`.
-   **–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π Telegram-–±–æ—Ç:**
    -   –ó–∞–ø—É—Å–∫ –ª—é–±–æ–π –∑–∞–¥–∞—á–∏ –±—ç–∫–∞–ø–∞ –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ inline-–∫–Ω–æ–ø–∫–∏.
    -   –ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –æ—Ç–∫–ª–∏–∫ –∏ —Ñ–æ–Ω–æ–≤–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–¥–∞—á.
    -   –û—Ç–ø—Ä–∞–≤–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ (—É—Å–ø–µ—Ö/–æ—à–∏–±–∫–∞) –≤ Telegram.
-   **–ë—ç–∫–∞–ø—ã –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é:** –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è `cron` –¥–ª—è –∫–∞–∂–¥–æ–π –∑–∞–¥–∞—á–∏.
-   **–ù–∞–¥–µ–∂–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `rclone` –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∞—Ä—Ö–∏–≤–æ–≤ –≤ –ª—é–±–æ–µ –æ–±–ª–∞—á–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ (WebDAV, Google Drive, S3 –∏ –¥—Ä.).
-   **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞:** –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π –≤ –æ–±–ª–∞–∫–µ –ø–æ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ –∑–∞–¥–∞–Ω–Ω–æ–≥–æ —Å—Ä–æ–∫–∞.
-   **–ò–∑–æ–ª—è—Ü–∏—è –∏ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å:** –í—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ –ø—Ä–æ—Ü–µ—Å—Å—ã (`cron`, –±–æ—Ç) —Ä–∞–±–æ—Ç–∞—é—Ç –≤–Ω—É—Ç—Ä–∏ –æ–¥–Ω–æ–≥–æ Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –ø–æ–¥ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º `Supervisord`.

## ‚öôÔ∏è –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

**–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:** `Docker`, `docker-compose`.

**1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:**
```bash
git clone https://github.com/dixon961/backup-app.git
cd backup-app
```

**2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å `rclone`:**
–ù–∞–º –Ω—É–∂–µ–Ω —Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ `rclone.conf`.
- –ó–∞–ø—É—Å—Ç–∏—Ç–µ –Ω–∞ –≤–∞—à–µ–º —Ö–æ—Å—Ç-–∫–æ–º–ø—å—é—Ç–µ—Ä–µ `rclone config` –¥–ª—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –≤–∞—à–µ–º—É –æ–±–ª–∞—á–Ω–æ–º—É —Ö—Ä–∞–Ω–∏–ª–∏—â—É.
- –î–∞–π—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—é –∏–º—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, `MyCloud`).
- –ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–∞–π–¥–∏—Ç–µ —Ñ–∞–π–ª `rclone.conf` (–æ–±—ã—á–Ω–æ –≤ `~/.config/rclone/`) –∏ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ –µ–≥–æ –≤ –ø–∞–ø–∫—É `app/config/rclone/` –¥–∞–Ω–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞.

**3. –°–æ–∑–¥–∞—Ç—å –∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å `config.yml`:**
–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `app/config/config.yml` –ø–æ —ç—Ç–æ–º—É —à–∞–±–ª–æ–Ω—É –∏ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ –µ–≥–æ.
```yaml
# app/config/config.yml
globals:
  rclone_remote_name: "MyCloud" # –ò–º—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∏–∑ rclone.conf
  remote_base_path: "server-backups"
  default_schedule: "0 2 * * *"  # –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω–æ –≤ –∑–∞–¥–∞—á–µ
  default_retention_days: 30

telegram:
  # –¢–æ–∫–µ–Ω –º–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –∑–¥–µ—Å—å –∏–ª–∏ —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è TELEGRAM_TOKEN
  # token: "12345:ABC-DEF1234567" 
  chat_id: 123456789 # –í–ê–® –õ–ò–ß–ù–´–ô User ID –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–æ—Ç–æ–º

tasks:
  - name: "my-project"
    source: "/projects/my-project" # –ü—É—Ç—å –∫ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –í–ù–£–¢–†–ò –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
    archive_prefix: "project-backup"
    schedule: "0 3 * * 1" # –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ (–∫–∞–∂–¥—ã–π –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ –≤ 3:00)
    retention_days: 60
  - name: "web-data"
    source: "/data/www"
    archive_prefix: "my-site"
    # –î–ª—è —ç—Ç–æ–π –∑–∞–¥–∞—á–∏ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
```

**4. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å `docker-compose.yml`:**
- **(–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)** –£–∫–∞–∂–∏—Ç–µ –≤–∞—à —Ç–æ–∫–µ–Ω Telegram –≤ `environment.TELEGRAM_TOKEN`, –µ—Å–ª–∏ –Ω–µ —Ö–æ—Ç–∏—Ç–µ —Ö—Ä–∞–Ω–∏—Ç—å –µ–≥–æ –≤ `config.yml`.
- **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ `volumes`**, —á—Ç–æ–±—ã –ø—Ä–æ–±—Ä–æ—Å–∏—Ç—å –ø–∞–ø–∫–∏ –¥–ª—è –±—ç–∫–∞–ø–∞ —Å —Ö–æ—Å—Ç-–º–∞—à–∏–Ω—ã –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä. –ü—É—Ç—å —Å–ª–µ–≤–∞ ‚Äî –Ω–∞ —Ö–æ—Å—Ç–µ, —Å–ø—Ä–∞–≤–∞ ‚Äî –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ (–¥–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å `source` –≤ `config.yml`).

–ü—Ä–∏–º–µ—Ä `docker-compose.yml`:
```yaml
version: '3.8'

services:
  backup-service:
    build: .
    container_name: backup-service
    restart: unless-stopped
    environment:
      # –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —Ç–æ–∫–µ–Ω–∞ (–±–æ–ª–µ–µ –±–µ–∑–æ–ø–∞—Å–Ω—ã–π —Å–ø–æ—Å–æ–±)
      - TELEGRAM_TOKEN=12345:ABC-DEF1234567
    volumes:
      # –ü—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é —Å –∫–æ–Ω—Ñ–∏–≥–∞–º–∏
      - ./app/config:/config
      # –ü—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è –±—ç–∫–∞–ø–∞
      - /path/on/host/my-project:/projects/my-project:ro
      - /path/on/host/www:/data/www:ro
```

**5. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å:**
```bash
docker compose up --build -d
```
–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç –ø—Ä–∏—à–ª–µ—Ç –≤–∞–º –≤ Telegram —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏.

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
1.  –û—Ç–∫—Ä–æ–π—Ç–µ —á–∞—Ç —Å –≤–∞—à–∏–º –±–æ—Ç–æ–º –≤ Telegram.
2.  –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É `/start`.
3.  –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ inline-–∫–Ω–æ–ø–∫–∏ –¥–ª—è –≤—ã–±–æ—Ä–∞ –∏ –∑–∞–ø—É—Å–∫–∞ –∑–∞–¥–∞—á —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è.

### –ë—ç–∫–∞–ø—ã –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é
–ó–∞–¥–∞—á–∏, –¥–ª—è –∫–æ—Ç–æ—Ä—ã—Ö –≤ `config.yml` —É–∫–∞–∑–∞–Ω–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ (`schedule`), –±—É–¥—É—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
```bash
docker compose logs -f
```
–í –ª–æ–≥–∞—Ö –≤—ã —É–≤–∏–¥–∏—Ç–µ —Ä–∞–±–æ—Ç—É –∏ `cron`, –∏ Telegram-–±–æ—Ç–∞ –±–ª–∞–≥–æ–¥–∞—Ä—è `Supervisord`.

### –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–µ—Ä–≤–∏—Å–∞
```bash
docker compose down
```

## ‚ö†Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

–ü–∞–ø–∫–∞ `app/config/` —Å–æ–¥–µ—Ä–∂–∏—Ç –≤–∞—à–∏ —Å–µ–∫—Ä–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (`rclone.conf`, `config.yml`) –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ `.gitignore`. **–ù–∏–∫–æ–≥–¥–∞ –Ω–µ –ø—É–±–ª–∏–∫—É–π—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–π –ø–∞–ø–∫–∏.** –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å `TELEGRAM_TOKEN` —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è, –∞ –Ω–µ —Ö—Ä–∞–Ω–∏—Ç—å –µ–≥–æ –≤ —Ñ–∞–π–ª–µ.
